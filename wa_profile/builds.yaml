# Define path to the conda environment file.
conda_environment: "../../spheres_profile/conda.yaml"

# Define custom auspice configuration to enable frequencies.
files:
  auspice_config: "spheres_profile/auspice_config.json"

# Define builds for each state and territory.
builds:
  washington_early-2020:
    colors: wa_profile/colors.tsv
    description: wa_profile/descriptions/early_description.md
    division: Washington
    max_date: 2020-05-31
    subsampling_scheme: early    

  washington_summer-2020:
    colors: wa_profile/colors.tsv
    description: wa_profile/descriptions/summer-2020_description.md
    division: Washington
    min_date: 2020-05-15
    subsampling_scheme: late

# Define subsampling scheme for state- and territory-level (hereafter
# "division") builds. This scheme should include as much local diversity for a
# given division as possible and contextual samples from the rest of the USA and
# the world.
subsampling:
  early:
    local-focus:
      # Evenly sample across time for the current division.
      group_by: "year month"
      max_sequences: 3500
      max_date: "{max_date}"
      query: --query "(country == 'USA' & division == '{division}')"
    usa-context:
      # Evenly sample across time from other divisions prioritizing samples that                                                                                                                                         # are that are genetically similar to the current division's sequences.
      group_by: "year month"
      max_sequences: 2800
      max_date: "{max_date}"
      query: --query "(country == 'USA' & division != '{division}')"
      priorities:
        type: proximity
        focus: local-focus
    global-context:
      # Evenly sample across time from the rest of the world excluding the USA.
      group_by: "region year month"
      max_sequences: 2800
      max_date: "{max_date}"
      query: --query "(country != 'USA')"
      priorities:
        type: proximity
        focus: local-focus

  late:
    local-focus-late:
      # Evenly sample from min-date on for the current division.
      group_by: "year month"
      max_sequences: 2500
      min_date: "{min_date}"
      query: --query "(country == 'USA' & division == '{division}')"
    local-all-time:
      # Samples across all time for the current division.
      group_by: "year month"
      max_sequences: 1000
      query: --query "(country == 'USA' & division = '{division}')"
    usa-context-late:
      # Evenly sample across time from min-date on from other divisions prioritizing samples that
      # are that are genetically similar to the current division's sequences.
      group_by: "year month"
      max_sequences: 2000
      min_date: "{min_date}"
      query: --query "(country == 'USA' & division != '{division}')"
      priorities:
        type: proximity
        focus: local-focus
    usa-context-all-time:
      # Samples across time from other divisions prioritizing genetically similar sequences.
      group_by: "year month"
      max_sequences: 800
      query: --query "(country == 'USA' & division != '{division}')"
      priorities:
        type: proximity
        focus: local-focus
    global-context-late:
      # Evenly sample across time from the rest of the world excluding the USA.
      group_by: "region year month"
      max_sequences: 2000
      min_date: "{min_date}"
      query: --query "(country != 'USA')"
      priorities:
        type: proximity
        focus: local-focus
    global-context-all-time:
      # Saples from the rest of the world (excluding the USA) from across all time.
      group_by: "region year month"
      max_sequences: 800
      query: --query "(country != 'USA')"
      priorities:
        type: proximity
        focus: local-focus
